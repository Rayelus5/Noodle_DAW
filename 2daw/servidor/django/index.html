<!doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Wiki Django — Índice</title>

        <style>
    :root{
      --bg:#1f1f1f;
      --panel:#222;
      --card:#2b2b2b;
      --accent:#39a06b;
      --muted:#cfcfcf;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--muted);font-family:"Courier New", Courier, monospace;}
    .app{display:flex;flex-direction:column;height:100vh;}

/* Header */
    header{
      background: linear-gradient(90deg, rgba(25,25,25,0.95), rgba(35,35,35,0.95));
      padding:12px 16px;
      display:flex;
      align-items:center;
      gap:12px;
      border-bottom:1px solid #333;
    }
    .brand{display:flex;align-items:center;gap:12px;}
    .brand img{height:44px;border-radius:8px;background:rgba(3,18,11,0.36);padding:3px;}
    .title{font-size:1.15rem;font-weight:700;color:#e8f5ea;}

/* Nav area */
    .nav-area{margin-left:auto;display:flex;align-items:center;gap:10px;}
    /* Opción 1: Modern pill */

    .unit-select.op1,
    .anchor-select.op1{
    background: linear-gradient(180deg, rgba(57,160,110,0.12), rgba(20,30,20,0.06));
    color: var(--muted);
    border: 1px solid rgba(255,255,255,0.04);
    padding: 10px 44px 10px 14px;      /* espacio para la flecha a la derecha */
    border-radius: 12px;              /* pill */
    font-weight: 800;
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    box-shadow: 0 4px 2px rgba(12, 29, 21, 0.5), inset 0 -1px 0 rgba(26, 53, 37, 0.8);
    transition: transform .08s ease, box-shadow .12s ease;
    background-repeat: no-repeat;
    background-position: calc(100% - 12px) center;
    /* Flecha SVG (white-ish) */
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23dfeff0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
    }

    /* Variación para anchor (más oscuro) */
    .anchor-select.op1{
    background: linear-gradient(180deg, rgba(10,10,10,0.18), rgba(6,6,6,0.04));
    font-weight:700;
    }

    /* Focus / hover */
    .unit-select.op1:focus,
    .anchor-select.op1:focus,
    .unit-select.op1:hover,
    .anchor-select.op1:hover{
    outline: none;
    transform: translateY(-1px);
    box-shadow: 0 8px 22px rgba(0,0,0,0.6), 0 0 0 3px rgba(57,160,110,0.06);
    }

    /* Disabled state */
    .unit-select.op1:disabled,
    .anchor-select.op1:disabled{
    opacity:0.5;
    cursor:not-allowed;
    }


    .nav-actions{display:flex;gap:8px;align-items:center;}
    .nav-actions a{color:var(--accent);text-decoration:none;font-weight:800;padding:6px 10px;border-radius:6px;}
    .nav-actions a:hover{background:#163f2a;border-color:#294b36;}

/* Mobile toggles */
    .menu-btn {
      display:none;
      background:transparent;
      color:var(--muted);
      border:1px solid #333;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
    }

/* Main layout */
    main{flex:1;display:flex;min-height:0;overflow:hidden;}
    .sidebar{
      width:320px;
      background:var(--panel);
      padding:18px;
      border-right:1px solid #222;
      box-sizing:border-box;
      overflow:auto;
      line-height:1.7;
      transition: transform .22s ease, opacity .22s ease;
    }
    .sidebar h3{margin:6px 0 20px 0;color:var(--muted);font-size:1.1rem;text-align:center;}
    .sidebar ul{list-style:none;padding:0;margin:0;}
    .sidebar li{margin-bottom:6px;padding:6px 0;border-bottom:1px solid #2b2b2b;}
    .sidebar a{color:var(--accent);text-decoration:none;font-weight:700;font-size:0.95rem;display:block;}
    .sidebar a:focus, .sidebar a:hover{outline:none;text-decoration:underline;padding-left:8px;}

/* iframe content */
    .reader{flex:1;background:#111;border:0;width:100%;height:100%;}

/* Footer */
    footer{padding:8px 12px;color:#9d9d9d;font-size:12px;text-align:center;border-top:1px solid #222;}

/* Mobile responsiveness */
    @media (max-width:900px){
      .sidebar{position:fixed;top:0;left:0;height:100vh;z-index:1200;transform:translateX(-110%);box-shadow: 8px 0 30px rgba(0,0,0,0.6);width:78%;max-width:320px;border-right:1px solid #111;}
      .sidebar.open{transform:translateX(0);}
      .menu-btn{display:inline-block;margin-left:8px;}
      /* make nav controls more touch-friendly and stacked */
      .nav-area{gap:8px;align-items:center;}
      .unit-select {a{padding:10px 12px;font-size:0.95rem;}}
      .nav-actions, .anchor-select {display: none;}
      .brand .title {display:none;} /* save space */
    }

/* Small visual tweaks */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
    .overlay {
      display:none;
      position:fixed;inset:0;background:rgba(0,0,0,0.55);z-index:1100;
    }
    .overlay.show{display:block;}
  </style>
    </head>
    <body>
        <div class="app">
            <a href="#reader" class="sr-only">Saltar al contenido</a>

            <header>
                <div class="brand" aria-hidden="false">
                    <img
                        src="https://static.djangoproject.com/img/logos/django-logo-negative.1d528e2cb5fb.png"
                        alt="Logo Django">
                    <div class="title">Wiki Django</div>
                </div>

                <div class="nav-area" role="navigation"
                    aria-label="Navegación principal">
                    <button class="menu-btn" id="menuToggle"
                        aria-expanded="false"
                        aria-controls="sidebar">Menú</button>

                    <label for="unitSelect" class="sr-only">Seleccionar
                        unidad</label>
                    <select id="unitSelect" class="unit-select op1"
                        title="Selecciona unidad"
                        aria-label="Seleccionar unidad">
                        <option value="ud1.html" selected>UD1 —
                            Introducción</option>
                        <option value="ud2.html">UD2 — Formularios</option>
                        <!--<option value="ud3.html"></option>-->
                    </select>

                    <label for="anchorSelect" class="sr-only">Ir a
                        sección</label>
                    <select id="anchorSelect" class="anchor-select op1"
                        title="Ir a sección" aria-label="Ir a sección">
                        <option value>Ir a sección...</option>
                        <!-- opciones se rellenan dinámicamente -->
                    </select>

                    <div class="nav-actions" role="group" aria-label="Acciones">
                        <a href="ud1.html" target="reader" id="openNew">Abrir
                            UD1</a>
                        <a href="#" id="helpBtn">Ayuda</a>
                    </div>
                </div>
            </header>

            <main>
                <aside id="sidebar" class="sidebar" role="navigation"
                    aria-label="Contenido de la unidad">
                    <h3 id="sidebarTitle">Contenido — UD1</h3>
                    <ul id="sidebarList" tabindex="0">
                        <!-- items dinámicos -->
                    </ul>
                </aside>

                <div id="overlay" class="overlay" tabindex="-1"
                    aria-hidden="true"></div>

                <iframe id="reader" name="reader" class="reader" src="ud1.html"
                    title="Contenido UD"></iframe>
            </main>

            <footer>
                <small>Wiki estática — creada para estudio. Usa el selector de
                    unidad para navegar. — (local)</small>
            </footer>
        </div>

        <script>
/* Controls */
const unitSelect = document.getElementById('unitSelect');
const anchorSelect = document.getElementById('anchorSelect');
const reader = document.getElementById('reader');
const sidebar = document.getElementById('sidebar');
const sidebarList = document.getElementById('sidebarList');
const sidebarTitle = document.getElementById('sidebarTitle');
const menuToggle = document.getElementById('menuToggle');
const overlay = document.getElementById('overlay');
const helpBtn = document.getElementById('helpBtn');
const openNew = document.getElementById('openNew');

let currentUnit = unitSelect.value || 'ud1.html';
let headingsCache = {}; // store headings per unit for faster switching

/* Utility: load unit into iframe and attempt to read headings after load */
function loadUnit(unit, anchor = '') {
  currentUnit = unit;
  const url = anchor ? `${unit}${anchor}` : unit;
  // set open link target to this unit for convenience
  openNew.href = unit;
  // set sidebar title
  sidebarTitle.textContent = `Contenido — ${unit.toUpperCase().replace('.HTML','')}`;
  // load iframe
  reader.src = url;

  // Reset anchor select while loading
  anchorSelect.innerHTML = '<option value="">Ir a sección...</option>';
  sidebarList.innerHTML = '<li style="color:#999">Cargando contenido…</li>';
}

/* After iframe loads, try to extract headings (only same-origin; else fallback) */
function extractHeadingsFromIframe() {
  const unit = currentUnit;
  try {
    const doc = reader.contentDocument || reader.contentWindow.document;
    // query h2 with id
    const h2s = Array.from(doc.querySelectorAll('h2[id]'));
    if (!h2s.length) {
      // fallback: try headings without id
      const alt = Array.from(doc.querySelectorAll('h2'));
      if(alt.length) {
        alt.forEach((el, i) => el.id = el.id || `section-${i+1}`);
      }
    }
    const headings = Array.from(doc.querySelectorAll('h2[id]')).map(h => ({ id: h.id, text: h.textContent.trim() }));
    if (headings.length) {
      headingsCache[unit] = headings;
      populateAnchors(headings, unit);
      return;
    }
  } catch (err) {
    // cross-origin or not accessible
    console.warn('No se pueden leer encabezados del iframe (cross-origin?):', err);
  }
  // fallback/default anchors if extraction failed
  const defaultAnchors = [
    { id: 'section-1', text: '1. Crear entorno de trabajo' },
    { id: 'section-2', text: '2. Instalación de Django' },
    { id: 'section-3', text: '3. Crear proyecto y aplicación' },
    { id: 'section-4', text: '4. Configuración inicial (settings.py)' },
    { id: 'section-5', text: '5. Configuración de URLs y Vistas' },
    { id: 'section-6', text: '6. Modelos (models.py)' },
    { id: 'section-7', text: '7. Vistas (views.py)' },
    { id: 'section-8', text: '8. Templates y static files' },
    { id: 'section-9', text: '9. Migraciones' },
    { id: 'section-10', text: '10. Panel de administración' },
    { id: 'section-11', text: '11. ORM y QuerySets' },
    { id: 'section-12', text: '12. Template Tags y Filtros' },
    { id: 'section-13', text: '13. Comandos útiles' },
  ];
  headingsCache[unit] = defaultAnchors;
  populateAnchors(defaultAnchors, unit);
}

/* Fill anchor dropdown and sidebar list */
function populateAnchors(headings, unit) {
  // anchor dropdown
  anchorSelect.innerHTML = '<option value="">Ir a sección...</option>';
  headings.forEach(h => {
    const opt = document.createElement('option');
    opt.value = `#${h.id}`;
    opt.textContent = h.text;
    anchorSelect.appendChild(opt);
  });

  // sidebar list
  sidebarList.innerHTML = '';
  headings.forEach(h => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = '#';
    a.dataset.src = `${unit}#${h.id}`;
    a.textContent = h.text;
    a.addEventListener('click', (ev) => {
      ev.preventDefault();
      reader.src = a.dataset.src;
      // close sidebar on mobile after selecting
      if (window.matchMedia('(max-width:900px)').matches) toggleSidebar(false);
    });
    li.appendChild(a);
    sidebarList.appendChild(li);
  });
}

/* Event: when unit changes from select */
unitSelect.addEventListener('change', (e) => {
  const unit = e.target.value;
  loadUnit(unit);
});

/* Event: go to anchor via select */
anchorSelect.addEventListener('change', (e) => {
  const an = e.target.value;
  if (!an) return;
  const base = currentUnit || unitSelect.value || 'ud1.html';
  reader.src = base + an;
});

/* Sidebar links (static ones) — keep for initial static markup */
document.querySelectorAll('.sidebar a').forEach(a=>{
  a.addEventListener('click', (ev)=>{
    ev.preventDefault();
    const src = ev.currentTarget.getAttribute('data-src');
    reader.src = src;
    // on small screens close sidebar
    if (window.matchMedia('(max-width:900px)').matches) toggleSidebar(false);
  });
});

/* iframe load event: extract headings */
reader.addEventListener('load', () => {
  // small delay to let content render
  setTimeout(extractHeadingsFromIframe, 200);
});

/* Menu toggle for mobile */
function toggleSidebar(force) {
  const isOpen = sidebar.classList.contains('open');
  const shouldOpen = typeof force === 'boolean' ? force : !isOpen;
  if (shouldOpen) {
    sidebar.classList.add('open');
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
    menuToggle.setAttribute('aria-expanded','true');
    menuToggle.focus();
  } else {
    sidebar.classList.remove('open');
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
    menuToggle.setAttribute('aria-expanded','false');
    menuToggle.focus();
  }
}
menuToggle.addEventListener('click', ()=> toggleSidebar());

overlay.addEventListener('click', ()=> toggleSidebar(false));

/* Keyboard: Esc closes sidebar */
document.addEventListener('keydown', (ev) => {
  if (ev.key === 'Escape') toggleSidebar(false);
});

/* Help button */
helpBtn.addEventListener('click', (ev) => {
  ev.preventDefault();
  alert('Selecciona la unidad en el menú. Usa "Ir a sección..." o el menú lateral para saltar a la sección deseada. En móvil abre "Menú".');
});

/* Init: populate headings for default unit after first load attempt (in case iframe cached) */
window.addEventListener('DOMContentLoaded', () => {
  // ensure openNew points to current unit
  openNew.href = currentUnit;
  // attempt to extract once iframe has loaded (if cached)
  setTimeout(() => {
    try { extractHeadingsFromIframe(); } catch(e) { /* ignore */ }
  }, 400);
});

/* Accessibility: focus trap when sidebar open (basic) */
let focusableSidebar = null;
function updateFocusable() {
  focusableSidebar = sidebar.querySelectorAll('a, button, select, [tabindex]:not([tabindex="-1"])');
}
sidebar.addEventListener('transitionend', updateFocusable);

</script>
    </body>
</html>
